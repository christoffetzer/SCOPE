image: ubuntu:16.04

variables:
  GIT_SUBMODULE_STRATEGY: recursive

before_script:
  - sudo apt-get update
  - sudo apt-get install -y  wget

run-SCOPE-stack:
  tags:
    - virtualbox-runner
  stage: build
  script:
    - sudo SCONE_HOSTINSTALLER/install_patched_docker.sh
    - sudo docker swarm init
# change user has not taken effect - run with sudo
    - sudo ./start-scope.sh
    - IP=`hostname -I | awk '{print $1;}'`
    - sudo docker stack ps SCOPE
    - sleep 5
    - sudo docker stack ps SCOPE
    - wget --retry-connrefused --waitretry=1 --read-timeout=20 --timeout=15 -t 8 http://$IP:4040
    - sudo ./stop-scope.sh

